<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>🔐 Cifrar ZIP - Móvil</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <style>
    body {font-family: sans-serif; background:#f2f2f2; padding:15px;}
    .container{max-width:400px;margin:auto;background:#fff;padding:20px;border-radius:10px;box-shadow:0 0 10px rgba(0,0,0,0.1);}
    h1{text-align:center;color:#333;}
    .file-box{border:2px dashed #aaa;padding:30px;text-align:center;cursor:pointer;margin-bottom:20px;}
    .btn{display:block;width:100%;padding:15px;margin:10px 0;border:none;border-radius:8px;font-size:16px;cursor:pointer;}
    .btn-primary{background:#667eea;color:#fff;}
    .btn-primary:disabled{background:#bbb;}
    .btn-success{background:#28a745;color:#fff;}
    .status{margin-top:10px;padding:10px;border-radius:6px;display:none;}
    .ok{background:#d4edda;color:#155724;}
    .err{background:#f8d7da;color:#721c24;}
  </style>
</head>
<body>
  <div class="container">
    <h1>🔐 Cifrar ZIP</h1>
    <div class="file-box" onclick="document.getElementById('fileInput').click()">
      📁 Pulsa o arrastra un ZIP
      <input type="file" id="fileInput" accept=".zip" style="display:none">
    </div>
    <button id="encryptBtn" class="btn btn-primary" disabled>🔒 Cifrar archivo</button>
    <button id="emailBtn" class="btn btn-success" style="display:none;">📧 Preparar correo</button>
    <div id="status" class="status"></div>
  </div>

<script>
const PASSWORD = "palote789133";
let selectedFile=null, encryptedName="";

document.getElementById("fileInput").addEventListener("change", e=>{
  if(e.target.files.length>0){
    selectedFile = e.target.files[0];
    document.getElementById("encryptBtn").disabled = false;
  }
});

document.getElementById("encryptBtn").addEventListener("click", async()=>{
  if(!selectedFile) return;
  try{
    show("Leyendo archivo...");
    const buf = await selectedFile.arrayBuffer();
    const wordArray = CryptoJS.lib.WordArray.create(buf);
    show("Cifrando...");
    const encrypted = CryptoJS.AES.encrypt(wordArray, PASSWORD).toString();
    encryptedName = selectedFile.name+".enc";
    const blob = new Blob([encrypted],{type:"text/plain"});
    const a=document.createElement("a");
    a.href=URL.createObjectURL(blob);
    a.download=encryptedName;
    a.click();
    show("✅ Cifrado correcto. Archivo descargado.","ok");
    document.getElementById("emailBtn").style.display="block";
  }catch(err){
    show("❌ Error: "+err,"err");
  }
});

document.getElementById("emailBtn").addEventListener("click",()=>{
  const subject="Archivo cifrado: "+encryptedName;
  const body=`Hola,
Adjunto archivo ${encryptedName}.
🔐 Contraseña: ${PASSWORD}`;
  window.location=`mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
});

function show(msg,type){
  const st=document.getElementById("status");
  st.innerText=msg;
  st.className="status "+(type||"");
  st.style.display="block";
}
</script>
</body>
</html>